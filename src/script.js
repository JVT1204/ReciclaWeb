/* ========================================
   RECICLAWEB - JAVASCRIPT
   Funcionalidades do site
======================================== */

// Estado global da aplica√ß√£o
let currentScreen = 'home';
let currentSlide = 0;
let gameScore = 0;
let gameItems = [];

// Dados dos tipos de lixo para o carrossel
const lixoTypes = [
    {
        id: 'plastico',
        icon: 'ü•§',
        title: 'PL√ÅSTICO - LIXEIRA VERMELHA',
        color: '#F44336',
        description: 'Garrafas PET, embalagens de produtos de limpeza, sacolas pl√°sticas, potes de iogurte, tampas de refrigerante, brinquedos quebrados.',
        tip: 'üí° Dica: Lave as embalagens antes de descartar para evitar contamina√ß√£o!'
    },
    {
        id: 'papel',
        icon: 'üìÑ',
        title: 'PAPEL - LIXEIRA AZUL',
        color: '#2196F3',
        description: 'Jornais, revistas, caixas de papel√£o, envelopes, papel de escrit√≥rio, livros velhos, embalagens de papel.',
        tip: 'üí° Dica: Remova grampos e clipes antes de descartar o papel!'
    },
    {
        id: 'vidro',
        icon: 'üç∂',
        title: 'VIDRO - LIXEIRA VERDE',
        color: '#4CAF50',
        description: 'Garrafas de vidro, potes de conserva, frascos de perfume, copos quebrados, vidros de janela.',
        tip: 'üí° Dica: Separe tampas e r√≥tulos antes de descartar o vidro!'
    },
    {
        id: 'metal',
        icon: 'ü•´',
        title: 'METAL - LIXEIRA AMARELA',
        color: '#FF9800',
        description: 'Latas de alum√≠nio, latas de conserva, tampas de garrafa, objetos de ferro, panelas velhas.',
        tip: 'üí° Dica: Amasse as latas para economizar espa√ßo na coleta!'
    },
    {
        id: 'organico',
        icon: 'üçå',
        title: 'ORG√ÇNICO - LIXEIRA MARROM',
        color: '#795548',
        description: 'Restos de comida, cascas de frutas e legumes, borra de caf√©, cascas de ovos, folhas secas.',
        tip: 'üí° Dica: Use restos org√¢nicos para fazer compostagem em casa!'
    }
];

// Dados para o jogo
const gameData = [
    { item: 'üçå', type: 'organico', name: 'Banana' },
    { item: 'ü•§', type: 'plastico', name: 'Garrafa PET' },
    { item: 'üìÑ', type: 'papel', name: 'Papel' },
    { item: 'üç∂', type: 'vidro', name: 'Garrafa de vidro' },
    { item: 'ü•´', type: 'metal', name: 'Lata de conserva' },
    { item: 'üçé', type: 'organico', name: 'Ma√ß√£' },
    { item: 'üì¶', type: 'papel', name: 'Caixa de papel√£o' },
    { item: 'ü•§', type: 'plastico', name: 'Copo pl√°stico' },
    { item: 'üç∫', type: 'vidro', name: 'Garrafa de cerveja' },
    { item: 'üîß', type: 'metal', name: 'Ferramenta de ferro' },
    { item: 'üç†', type: 'organico', name: 'Batata' },
    { item: 'üõçÔ∏è', type: 'plastico', name: 'Sacola pl√°stica' },
    { item: 'üìù', type: 'papel', name: 'Bloco de notas' },
    { item: 'üçØ', type: 'vidro', name: 'Pote de mel' },
    { item: 'üõ†Ô∏è', type: 'metal', name: 'Chave de fenda' },
    { item: 'ü•¨', type: 'organico', name: 'Folha de alface' },
    { item: 'üß¥', type: 'plastico', name: 'Frasco de sabonete l√≠quido' },
    { item: 'üì¨', type: 'papel', name: 'Envelope usado' },
    { item: 'üçæ', type: 'vidro', name: 'Garrafa de vinho' },
    { item: 'üî©', type: 'metal', name: 'Parafuso' }
];

// ========================================
// NAVEGA√á√ÉO ENTRE TELAS
// ========================================

function showScreen(screenId) {
    // Esconder todas as telas
    const screens = document.querySelectorAll('.screen');
    screens.forEach(screen => {
        screen.classList.remove('active');
        screen.setAttribute('aria-hidden', 'true');
    });
    
    // Mostrar tela selecionada
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
        targetScreen.classList.add('active');
        targetScreen.setAttribute('aria-hidden', 'false');
        currentScreen = screenId;
        
        // Atualizar navega√ß√£o ativa
        updateActiveNavigation(screenId);
        
        // Fechar menu mobile se estiver aberto
        closeMobileMenu();
        
        // Inicializar funcionalidades espec√≠ficas da tela
        if (screenId === 'home') {
            initializeCarousel();
        } else if (screenId === 'game') {
            initializeGame();
        }
    }
}

function updateActiveNavigation(screenId) {
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.classList.remove('active');
        link.removeAttribute('aria-current');
    });
    
    const activeLink = document.querySelector(`[onclick="showScreen('${screenId}')"]`);
    if (activeLink) {
        activeLink.classList.add('active');
        activeLink.setAttribute('aria-current', 'page');
    }
}

// ========================================
// MENU MOBILE
// ========================================

function toggleMobileMenu() {
    const nav = document.getElementById('mainNav');
    const button = document.querySelector('.mobile-menu-toggle');
    
    if (nav && button) {
        const isOpen = nav.classList.contains('active');
        
        if (isOpen) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }
}

function openMobileMenu() {
    const nav = document.getElementById('mainNav');
    const button = document.querySelector('.mobile-menu-toggle');
    
    if (nav && button) {
        nav.classList.add('active');
        button.setAttribute('aria-expanded', 'true');
        button.setAttribute('aria-label', 'Fechar menu');
    }
}

function closeMobileMenu() {
    const nav = document.getElementById('mainNav');
    const button = document.querySelector('.mobile-menu-toggle');
    
    if (nav && button) {
        nav.classList.remove('active');
        button.setAttribute('aria-expanded', 'false');
        button.setAttribute('aria-label', 'Abrir menu');
    }
}

// ========================================
// CARROSSEL
// ========================================

function initializeCarousel() {
    const carouselWrapper = document.querySelector('.carousel-wrapper');
    if (!carouselWrapper) return;
    
    // Limpar conte√∫do existente
    carouselWrapper.innerHTML = '';
    
    // Criar slides para cada tipo de lixo
    lixoTypes.forEach((lixo, index) => {
        const slide = createSlideElement(lixo, index);
        carouselWrapper.appendChild(slide);
    });
    
    // Mostrar slide inicial
    showSlide(0);
}

function createSlideElement(lixo, index) {
    const slide = document.createElement('div');
    slide.className = `lixo-card ${lixo.id}${index === 0 ? ' active' : ''}`;
    slide.id = `slide-${index}`;
    
    slide.innerHTML = `
        <div class="lixo-icon ${lixo.id}">${lixo.icon}</div>
        <h3 class="lixo-title" style="color: ${lixo.color};">${lixo.title}</h3>
        <p class="lixo-description">${lixo.description}</p>
        <div class="lixo-tip">${lixo.tip}</div>
    `;
    
    return slide;
}

function showSlide(slideIndex) {
    const slides = document.querySelectorAll('.lixo-card');
    const indicators = document.querySelectorAll('.indicator');
    
    // Esconder todos os slides
    slides.forEach(slide => slide.classList.remove('active'));
    
    // Mostrar slide atual
    if (slides[slideIndex]) {
        slides[slideIndex].classList.add('active');
    }
    
    // Atualizar indicadores
    indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === slideIndex);
        indicator.setAttribute('aria-selected', index === slideIndex);
    });
    
    currentSlide = slideIndex;
}

function nextSlide() {
    const nextIndex = (currentSlide + 1) % lixoTypes.length;
    showSlide(nextIndex);
}

function previousSlide() {
    const prevIndex = currentSlide === 0 ? lixoTypes.length - 1 : currentSlide - 1;
    showSlide(prevIndex);
}

function goToSlide(slideIndex) {
    if (slideIndex >= 0 && slideIndex < lixoTypes.length) {
        showSlide(slideIndex);
    }
}

// ========================================
// JOGO
// ========================================

function initializeGame() {
    gameScore = 0;
    gameItems = [...gameData]; // Copiar array
    updateScore();
    newItem();
}

function newItem() {
    if (gameItems.length === 0) {
        // Reiniciar jogo
        gameItems = [...gameData];
        gameScore = 0;
    }
    
    const randomIndex = Math.floor(Math.random() * gameItems.length);
    const selectedItem = gameItems.splice(randomIndex, 1)[0];
    
    const trashElement = document.getElementById('currentTrash');
    if (trashElement) {
        trashElement.textContent = selectedItem.item;
        trashElement.setAttribute('data-type', selectedItem.type);
        trashElement.setAttribute('data-name', selectedItem.name);
    }
    
    updateScore();
}

function checkAnswer(selectedBinType) {
    const trashElement = document.getElementById('currentTrash');
    if (!trashElement) return;
    
    const correctType = trashElement.getAttribute('data-type');
    const itemName = trashElement.getAttribute('data-name');
    
    if (selectedBinType === correctType) {
        gameScore++;
        showFeedback(`‚úÖ Correto! ${itemName} vai para a lixeira ${correctType}!`, true);
    } else {
        showFeedback(`‚ùå Errado! ${itemName} deveria ir para a lixeira ${correctType}.`, false);
    }
    
    updateScore();
    
    // Pr√≥ximo item ap√≥s delay
    setTimeout(() => {
        newItem();
    }, 2000);
}

function showFeedback(message, isCorrect) {
    // Criar elemento de feedback se n√£o existir
    let feedback = document.getElementById('gameFeedback');
    if (!feedback) {
        feedback = document.createElement('div');
        feedback.id = 'gameFeedback';
        feedback.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        `;
        document.body.appendChild(feedback);
    }
    
    feedback.textContent = message;
    feedback.style.color = isCorrect ? '#2E7D32' : '#F44336';
    feedback.style.display = 'block';
    
    // Esconder ap√≥s 2 segundos
    setTimeout(() => {
        feedback.style.display = 'none';
    }, 2000);
}

function updateScore() {
    const scoreElement = document.querySelector('.score strong');
    if (scoreElement) {
        scoreElement.textContent = `${gameScore} / ${gameData.length}`;
    }
}

function showStats() {
    const percentage = Math.round((gameScore / gameData.length) * 100);
    const message = `üìä Sua pontua√ß√£o: ${gameScore}/${gameData.length} (${percentage}%)\n\n`;
    
    let performance = '';
    if (percentage >= 90) {
        performance = 'üåü Excelente! Voc√™ √© um expert em reciclagem!';
    } else if (percentage >= 70) {
        performance = 'üëç Muito bom! Continue praticando!';
    } else if (percentage >= 50) {
        performance = 'üìö Bom come√ßo! Estude mais sobre reciclagem.';
    } else {
        performance = 'üí™ N√£o desista! Pratique mais e voc√™ vai melhorar!';
    }
    
    alert(message + performance);
}

// ========================================
// EVENT LISTENERS PARA O JOGO
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    // Adicionar event listeners para as lixeiras
    const bins = document.querySelectorAll('.bin');
    bins.forEach(bin => {
        bin.addEventListener('click', function() {
            if (currentScreen === 'game') {
                const binType = this.getAttribute('data-type');
                checkAnswer(binType);
            }
        });
    });
    
    // Fechar menu mobile ao clicar fora dele
    document.addEventListener('click', function(event) {
        const nav = document.getElementById('mainNav');
        const button = document.querySelector('.mobile-menu-toggle');
        
        if (nav && nav.classList.contains('active')) {
            // Se clicou fora do menu e do bot√£o, fechar o menu
            if (!nav.contains(event.target) && !button.contains(event.target)) {
                closeMobileMenu();
            }
        }
    });
    
    // Fechar menu mobile ao redimensionar a tela (se voltar para desktop)
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMobileMenu();
        }
    });
    
    // Inicializar carrossel na primeira carga
    initializeCarousel();
});

// ========================================
// FUN√á√ïES GLOBAIS (para compatibilidade com onclick)
// ========================================

// Tornar fun√ß√µes globais para uso nos atributos onclick
window.showScreen = showScreen;
window.toggleMobileMenu = toggleMobileMenu;
window.previousSlide = previousSlide;
window.nextSlide = nextSlide;
window.goToSlide = goToSlide;
window.newItem = newItem;
window.showStats = showStats;
